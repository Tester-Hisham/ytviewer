<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Liquid Glass YouTube Viewer - Visual Blobs</title>
<style>
  :root {
    --bg: #0f1115;
    --panel: #161a22;
    --panel-2: #1c2230;
    --text: #f5f7fb;
    --muted: #a7b0c0;
    --brand: #ff33cc;
    --radius: 22px;
    --shadow: 0 25px 60px rgba(0, 0, 0, .7);
  }
  [data-theme="light"] {
    --bg: #f2f2f2;
    --panel: #ffffff;
    --panel-2: #ededed;
    --text: #222;
    --muted: #666;
    --brand: #ff33cc;
  }
  * { box-sizing: border-box }
  html, body { height: 100%; margin: 0; font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Arial, Helvetica, sans-serif; transition: all 0.3s; overflow: hidden; }
  body { 
    background: linear-gradient(180deg, var(--bg), #0b0d12);
    color: var(--text);
  }

  /* === Glowing blob background === */
  #blobs {
    position: fixed; /* sits behind content but on top of body background */
    inset: 0;
    z-index: 0;      /* << FIX: was -1 (invisible behind page). Now visible. */
    pointer-events: none;
    overflow: hidden;
  }
  .blob {
    position: absolute;
    width: 42vmax;
    height: 42vmax;
    border-radius: 50%;
    /* vivid glow + transparency */
    background: radial-gradient(circle at 50% 50%, rgba(255, 51, 204, 0.60), rgba(255, 51, 204, 0.25) 30%, transparent 70%);
    filter: blur(80px);  /* strong glow but not too foggy */
    transform: translate3d(0,0,0) scale(1);
    will-change: transform, background;
  }

  /* App UI */
  .app { position: relative; z-index: 1; display: grid; grid-template-rows: auto 1fr; gap: 20px; max-width: 1300px; margin: 0 auto; padding: 20px; }
  .bar { display: grid; grid-template-columns: 1fr auto auto auto auto auto auto auto; gap: 12px; align-items: center; background: var(--panel); padding: 16px; border-radius: var(--radius); box-shadow: var(--shadow); backdrop-filter: blur(30px); }
  .input { display: flex; gap: 12px; align-items: center; background: var(--panel-2); border: 1px solid rgba(255,255,255,.08); padding: 12px 16px; border-radius: 20px; backdrop-filter: blur(35px); }
  .input input { flex: 1; border: 0; outline: none; background: transparent; color: var(--text); font-size: 16px; }
  .btn { border: 0; border-radius: 20px; padding: 12px 18px; background: var(--brand); color: #fff; font-weight: 700; cursor: pointer; transition: all 0.3s; }
  .btn.ghost { background: transparent; color: var(--text); border: 1px solid rgba(255,255,255,.12); }
  .btn:hover { transform: translateY(-1px) scale(1.05); box-shadow: 0 20px 60px rgba(255, 51, 204, .6); }
  select { border-radius: 12px; padding: 6px 12px; background: var(--panel-2); color: var(--text); border:1px solid rgba(255,255,255,.08); }

  .grid { display: grid; grid-template-columns: 3fr auto; gap: 20px; height: calc(100vh - 180px); transition: all 0.4s; }
  .player { background: #000; border-radius: var(--radius); overflow: hidden; box-shadow: var(--shadow); position: relative; backdrop-filter: blur(25px); transition: all 0.5s; }
  .player .placeholder { position: absolute; inset:0; display: grid; place-items: center; color: #8891a4; font-size: 20px; transition: opacity 0.5s; }
  .list { background: var(--panel); border-radius: var(--radius); box-shadow: var(--shadow); display: flex; flex-direction: column; min-height: 0; backdrop-filter: blur(30px); width: 320px; transition: width 0.4s ease, opacity 0.3s ease; }
  .list-header { display: flex; align-items: center; justify-content: space-between; padding: 14px 16px; border-bottom: 1px solid rgba(255,255,255,.06); }
  .items { overflow: auto; padding: 12px; transition: opacity 0.3s; flex:1; }
  .item { display: grid; grid-template-columns: 140px 1fr auto; gap: 12px; align-items: center; padding: 12px; border-radius: 16px; cursor: grab; transition:0.25s; }
  .item:hover { background: rgba(255,255,255,.06); }
  .item.active { background: rgba(255,51,204,.25); }
  .item.dragging { opacity:0.4; background: rgba(255,255,255,.1); }
  .thumb { width:140px; height:80px; border-radius:16px; object-fit:cover; background:#0a0c12; }
  .title { font-weight:700; line-height:1.3; font-size:15px; }
  .meta { font-size:12px; color: var(--muted); }
  .x { opacity:.8; border:0; background:transparent; color:var(--muted); cursor:pointer; font-size:20px; transition:0.2s; }
  .x:hover { opacity:1; transform:scale(1.1); }
  .list.minimized { width:0 !important; opacity:0; pointer-events:none; }
  #toastContainer { position: fixed; top: 20px; right: 20px; z-index: 10; display: flex; flex-direction: column; align-items: flex-end; }

  @media (max-width:1024px){
    .grid { grid-template-columns:1fr; grid-template-rows:1fr 320px; height:auto; }
    .list { min-height:320px; width:100%; }
  }
</style>
</head>
<body data-theme="dark">

<!-- Glowing Background -->
<div id="blobs">
  <div class="blob" style="top:-10%; left:-10%"></div>
  <div class="blob" style="top:20%; right:-15%"></div>
  <div class="blob" style="bottom:-15%; left:10%"></div>
</div>

<div class="app">
  <div class="bar">
    <div class="input"><input id="url" placeholder="Paste YouTube URL or video ID" /></div>
    <button class="btn" id="addBtn">Add</button>
    <button class="btn ghost" id="pasteBtn">📋 Paste</button>
    <button class="btn ghost" id="prevBtn">⟨ Prev</button>
    <button class="btn ghost" id="nextBtn">Next ⟩</button>
    <button class="btn ghost" id="minBtn">⇔</button>
    <select id="playlistSelect"></select>
    <button class="btn ghost" id="newPlaylistBtn">New</button>
    <button class="btn ghost" id="deletePlaylistBtn">Delete</button>
    <button class="btn ghost" id="themeBtn">🌗</button>
    <button class="btn ghost" id="micBtn">🎤 Mic React</button>
  </div>

  <div class="grid">
    <section class="player">
      <div id="player"></div>
      <div class="placeholder" id="placeholder">Add a video to start ▶</div>
    </section>

    <aside class="list" id="playlist">
      <div class="list-header">
        <div style="font-weight:700">Playlist</div>
        <div class="actions">
          <button class="btn ghost" id="shuffleBtn">Shuffle</button>
          <button class="btn ghost" id="clearBtn">Clear</button>
        </div>
      </div>
      <div class="items" id="items"></div>
    </aside>
  </div>
</div>
<div id="toastContainer"></div>

<script>
/* =========================
   1) Glowing Blobs Engine
   ========================= */
const blobs = [...document.querySelectorAll('.blob')];
let phases = blobs.map((_,i)=> Math.random()*Math.PI*2);
let hues   = [310, 190, 260]; // starting hues (pink/cyan/purple)
let analyser = null, dataArray = null;

function animateBlobs(){
  requestAnimationFrame(animateBlobs);

  // base float
  const t = performance.now() * 0.001;
  blobs.forEach((b, i) => {
    const phase = phases[i] += 0.015 + i*0.005;
    const floatX = Math.sin(t + i*0.7) * (25 + i*10);
    const floatY = Math.cos(t*1.2 + i*0.9) * (20 + i*8);

    // audio-reactive scale per band (if analyser available)
    let scale = 1, hue = hues[i];
    if (analyser && dataArray) {
      analyser.getByteFrequencyData(dataArray);
      const len = dataArray.length;
      const third = Math.floor(len/3);
      const bands = [
        avg(dataArray, 0, third),              // low
        avg(dataArray, third, third),          // mid
        avg(dataArray, third*2, len - third*2) // high
      ];
      const factor = [0.006, 0.004, 0.003][i % 3]; // bass bigger
      scale = 1 + bands[i % 3] * factor;
      hue = (hues[i] + bands[i % 3]*0.6) % 360;
    }

    b.style.transform = `translate3d(${floatX}px, ${floatY}px, 0) scale(${scale})`;
    b.style.background = `radial-gradient(circle at 50% 50%, hsl(${hue} 90% 60% / 0.65), hsl(${hue} 90% 55% / 0.32) 30%, transparent 70%)`;
  });
}
function avg(arr, start, count){
  let s = 0;
  for (let i=start; i<start+count; i++) s += arr[i]||0;
  return count ? s / count : 0;
}
animateBlobs();

// optional parallax
document.addEventListener('pointermove', (e)=>{
  const x = (e.clientX / innerWidth) - 0.5;
  const y = (e.clientY / innerHeight) - 0.5;
  blobs.forEach((b,i)=>{
    const strength = 12 + i*8;
    b.style.translate = `${x*strength}px ${y*strength}px`;
  });
});

// Microphone-based analyser (works for mic or loopback device like “Stereo Mix”)
document.getElementById('micBtn').addEventListener('click', async ()=>{
  try{
    const stream = await navigator.mediaDevices.getUserMedia({ audio:true });
    const audioCtx = new (window.AudioContext || window.webkitAudioContext)();
    const src = audioCtx.createMediaStreamSource(stream);
    analyser = audioCtx.createAnalyser();
    analyser.fftSize = 256;
    src.connect(analyser);
    dataArray = new Uint8Array(analyser.frequencyBinCount);
    notify('Mic visualizer on');
  }catch(err){
    notify('Mic permission denied or unavailable');
    console.error(err);
  }
});

/* =========================
   2) App / Playlist System
   ========================= */
const state = { playlists:{ "Default":[] }, currentPlaylist:"Default", idx:-1, sidebarMinimized:false, positions:{} };
const itemsEl=document.getElementById('items');
const urlEl=document.getElementById('url');
const placeholder=document.getElementById('placeholder');
const playlistEl=document.getElementById('playlist');
const playlistSelect=document.getElementById('playlistSelect');
let player;

// Toast
function notify(msg,dur=2000){
  const toast=document.createElement('div');
  toast.textContent=msg;
  toast.style.cssText="background:rgba(255,51,204,0.92);color:#fff;padding:10px 14px;border-radius:12px;margin-top:6px;box-shadow:0 10px 30px rgba(0,0,0,0.25);opacity:0;transform:translateY(-6px);transition:0.25s;";
  document.getElementById('toastContainer').appendChild(toast);
  requestAnimationFrame(()=>{ toast.style.opacity=1; toast.style.transform='translateY(0)'; });
  setTimeout(()=>{ toast.style.opacity=0; toast.style.transform='translateY(-6px)'; setTimeout(()=>toast.remove(),250); }, dur);
}

// Save/load
function saveState(){ localStorage.setItem('ytState', JSON.stringify(state)); }
function loadState(){
  const s = localStorage.getItem('ytState');
  if(s){ Object.assign(state, JSON.parse(s)); }
  renderPlaylistSelect();
  renderList();
  playlistEl.classList.toggle('minimized', state.sidebarMinimized);
  if(state.idx>=0) playAt(state.idx);
}
function renderPlaylistSelect(){
  playlistSelect.innerHTML='';
  for(const name in state.playlists){
    const opt=document.createElement('option');
    opt.value=name; opt.textContent=name;
    if(name===state.currentPlaylist) opt.selected=true;
    playlistSelect.appendChild(opt);
  }
}
playlistSelect.onchange=function(){ state.currentPlaylist=this.value; state.idx=-1; renderList(); notify("Switched to: "+state.currentPlaylist); }

// Buttons
document.getElementById('newPlaylistBtn').onclick=function(){
  const name=prompt("Playlist name:"); if(!name) return;
  state.playlists[name]=[]; state.currentPlaylist=name; state.idx=-1;
  renderPlaylistSelect(); renderList(); notify("Created: "+name); saveState();
};
document.getElementById('deletePlaylistBtn').onclick=function(){
  if(!confirm("Delete this playlist?")) return;
  delete state.playlists[state.currentPlaylist];
  const keys=Object.keys(state.playlists);
  state.currentPlaylist=keys[0]||"Default"; state.idx=-1;
  renderPlaylistSelect(); renderList(); notify("Deleted playlist"); saveState();
};
document.getElementById('themeBtn').onclick = () => {
  const newTheme = document.body.dataset.theme === "dark" ? "light" : "dark";
  document.body.dataset.theme = newTheme;
  localStorage.setItem('theme', newTheme);
  notify("Theme switched");
};
const savedTheme = localStorage.getItem('theme'); if (savedTheme) document.body.dataset.theme = savedTheme;

document.getElementById('minBtn').onclick=()=>{ playlistEl.classList.toggle('minimized'); state.sidebarMinimized = playlistEl.classList.contains('minimized'); saveState(); };
document.getElementById('shuffleBtn').onclick=()=>{ shuffle(state.playlists[state.currentPlaylist]); renderList(); notify("Playlist shuffled"); };
document.getElementById('clearBtn').onclick=()=>{ state.playlists[state.currentPlaylist]=[]; state.idx=-1; renderList(); if(player) player.stopVideo(); placeholder.style.display='grid'; notify("Playlist cleared"); saveState(); };
document.getElementById('addBtn').onclick=async()=>{
  const raw=urlEl.value.trim(); if(!raw) return;
  const id=extractVideoId(raw); if(!id) return alert('Invalid YouTube video ID or URL.');
  const title=await fetchMeta(id);
  state.playlists[state.currentPlaylist].push({id,title});
  urlEl.value=''; renderList(); if(state.idx===-1) playAt(0);
  notify("Added: "+title); saveState();
};
document.getElementById('pasteBtn').onclick=async()=>{
  try{ const text=await navigator.clipboard.readText(); if(!text.trim()) return alert('Clipboard empty'); urlEl.value=text; document.getElementById('addBtn').click(); }
  catch{ alert('Clipboard access denied'); }
};
document.getElementById('nextBtn').onclick=()=>next();
document.getElementById('prevBtn').onclick=()=>prev();

// Fetch video title
async function fetchMeta(id){ 
  try{ const res=await fetch(`https://www.youtube.com/oembed?url=https://www.youtube.com/watch?v=${id}&format=json`);
       const data=await res.json(); return data.title; }
  catch{ return `Video ${id}`; } 
}

// Render list
function renderList(){
  const list=state.playlists[state.currentPlaylist]||[];
  itemsEl.innerHTML='';
  list.forEach((v,i)=>{
    const row=document.createElement('div');
    row.className='item'+(i===state.idx?' active':''); row.draggable=true; row.dataset.index=i; row.onclick=()=>playAt(i);
    row.innerHTML=`<img class="thumb" src="https://i.ytimg.com/vi/${v.id}/hqdefault.jpg" alt="thumb"/><div><div class="title">${v.title}</div><div class="meta">ID: ${v.id}</div></div><button class="x" title="Remove">✕</button>`;
    row.querySelector('.x').onclick=ev=>{ ev.stopPropagation(); removeAt(i); };
    row.addEventListener('dragstart', e=>{ e.dataTransfer.setData('text/plain', i); row.classList.add('dragging'); });
    row.addEventListener('dragend', ()=>row.classList.remove('dragging'));
    row.addEventListener('dragover', e=>e.preventDefault());
    row.addEventListener('drop', e=>{
      e.preventDefault();
      const from=parseInt(e.dataTransfer.getData('text/plain'));
      if(from!==i){ const [moved]=list.splice(from,1); list.splice(i,0,moved); renderList(); saveState(); }
    });
    itemsEl.appendChild(row);
  });
  saveState();
}

function removeAt(i){
  const list=state.playlists[state.currentPlaylist];
  const removed=list.splice(i,1)[0];
  if(state.idx>=list.length) state.idx=list.length-1;
  renderList();
  if(state.idx>=0) playAt(state.idx); else{ if(player) player.stopVideo(); placeholder.style.display='grid'; }
  notify("Removed: "+removed.title); saveState();
}

// Playback
function next(){ const list=state.playlists[state.currentPlaylist]; if(list.length) playAt((state.idx+1)%list.length); }
function prev(){ const list=state.playlists[state.currentPlaylist]; if(list.length) playAt((state.idx-1+list.length)%list.length); }
function shuffle(arr){ for(let i=arr.length-1;i>0;i--){ const j=Math.floor(Math.random()*(i+1)); [arr[i],arr[j]]=[arr[j],arr[i]]; } }
function extractVideoId(input){
  const patterns=[/youtu\.be\/([\w-]{11})/,/v=([\w-]{11})/,/shorts\/([\w-]{11})/,/embed\/([\w-]{11})/,/([\w-]{11})$/];
  for(const re of patterns){ const m=input.match(re); if(m) return m[1]; }
  return null;
}

function onYouTubeIframeAPIReady(){
  player=new YT.Player('player',{
    height:'100%', width:'100%',
    playerVars:{autoplay:1,modestbranding:1,rel:0,playsinline:1},
    events:{
      onStateChange:({data})=>{
        if(player && player.getCurrentTime){
          if(data===YT.PlayerState.PLAYING){
            const interval=setInterval(()=>{
              if(state.idx>=0 && player && player.getCurrentTime){
                const videoId=state.playlists[state.currentPlaylist][state.idx].id;
                state.positions[videoId]=player.getCurrentTime();
                saveState();
              }
            },1000);
            player.intervalRef=interval;
          }
          if(data!==YT.PlayerState.PLAYING && player.intervalRef) clearInterval(player.intervalRef);
        }
        if(data===YT.PlayerState.ENDED) next();
      }
    }
  });
}

function playAt(i){
  const list=state.playlists[state.currentPlaylist]; if(!list[i]) return;
  state.idx=i; renderList(); const id=list[i].id; placeholder.style.display='none';
  const row=itemsEl.children[i]; if(row) row.scrollIntoView({behavior:'smooth',block:'nearest'});
  const startTime=state.positions[id]||0;
  if(startTime>5){
    const mins=Math.floor(startTime/60); const secs=Math.floor(startTime%60).toString().padStart(2,'0');
    notify(`Resuming '${list[i].title}' at ${mins}:${secs}`, 2200);
  }
  if(player && player.loadVideoById) player.loadVideoById({videoId:id,startSeconds:startTime});
  else document.getElementById('player').innerHTML=`<iframe width="100%" height="100%" src="https://www.youtube.com/embed/${id}?autoplay=1&start=${Math.floor(startTime)}&rel=0&modestbranding=1&enablejsapi=1" allow="autoplay; encrypted-media" allowfullscreen></iframe>`;
}

// Keyboard controls
document.addEventListener('keydown', e=>{
  if(e.target.tagName==='INPUT') return;
  switch(e.code){
    case 'Space': e.preventDefault(); if(player && player.getPlayerState){ const s=player.getPlayerState(); s===YT.PlayerState.PLAYING?player.pauseVideo():player.playVideo(); } break;
    case 'ArrowRight': next(); break;
    case 'ArrowLeft': prev(); break;
    case 'ArrowUp': if(player && player.getVolume){ const v=Math.min(player.getVolume()+5,100); player.setVolume(v); notify(`Volume: ${v}%`);} break;
    case 'ArrowDown': if(player && player.getVolume){ const v=Math.max(player.getVolume()-5,0); player.setVolume(v); notify(`Volume: ${v}%`);} break;
  }
});

// Boot
(function loadYT(){ const tag=document.createElement('script'); tag.src='https://www.youtube.com/iframe_api'; document.head.appendChild(tag); })();
(function init(){ loadState(); })();
</script>
</body>
</html>
